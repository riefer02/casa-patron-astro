---
globs: *.astro,astro.config.mjs
description: "SEO optimization and performance configuration for Casa Patron Astro migration"
---

# SEO & Performance Optimization Guide

## üéØ SEO Component Migration

### SEO Component for Astro
```astro
---
// src/components/SEO.astro
export interface Props {
  title?: string
  description?: string
  keywords?: string[]
  image?: string
  url?: string
  type?: 'website' | 'article'
  schemaMarkup?: object
  noIndex?: boolean
}

const {
  title = "Casa Patron: Short Term Vacation Rental Home in Alto, NM",
  description = "Escape to the stunning mountains of Alto, NM and stay at Casa Patron, a beautiful short term vacation rental home located near Ruidoso.",
  keywords = [],
  image = "/cp-og-image.jpg",
  url = Astro.url.href,
  type = "website",
  schemaMarkup,
  noIndex = false
} = Astro.props

const canonicalUrl = new URL(url, Astro.site).href
const imageUrl = new URL(image, Astro.site).href
---

<!-- Primary Meta Tags -->
<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
{keywords.length > 0 && <meta name="keywords" content={keywords.join(', ')} />}
<link rel="canonical" href={canonicalUrl} />
{noIndex && <meta name="robots" content="noindex, nofollow" />}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type} />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={imageUrl} />
<meta property="og:site_name" content="Casa Patron" />

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:url" content={canonicalUrl} />
<meta property="twitter:title" content={title} />
<meta property="twitter:description" content={description} />
<meta property="twitter:image" content={imageUrl} />

<!-- Additional SEO Meta -->
<meta name="author" content="Casa Patron" />
<meta name="copyright" content="Casa Patron" />
<meta name="language" content="English" />
<meta name="revisit-after" content="7 days" />

<!-- Geo Meta for Local Business -->
<meta name="geo.region" content="US-NM" />
<meta name="geo.placename" content="Alto, New Mexico" />
<meta name="geo.position" content="33.41047791700064;-105.6845322600749" />
<meta name="ICBM" content="33.41047791700064, -105.6845322600749" />

<!-- Schema Markup -->
{schemaMarkup && (
  <script type="application/ld+json" set:html={JSON.stringify(schemaMarkup)} />
)}
```

### Schema Markup Templates
```js
// src/utils/schema.js
export const lodgingBusinessSchema = (data = {}) => ({
  "@context": "https://schema.org",
  "@type": "LodgingBusiness",
  name: "Casa Patron",
  description: "Escape to the stunning mountains of Alto, NM and stay at Casa Patron, a beautiful short term vacation rental home located near Ruidoso. This family-friendly home is perfect for large parties and is conveniently located next to Ski Apache.",
  image: "https://casapatronalto.com/cp-mural.jpg",
  telephone: "+1-817-223-0272",
  email: "valerie@casapatronalto.com",
  address: {
    "@type": "PostalAddress",
    streetAddress: "176 Neill Rd",
    addressLocality: "Alto",
    addressRegion: "NM",
    postalCode: "88312",
    addressCountry: "US"
  },
  priceRange: "$240-$900 per night",
  geo: {
    "@type": "GeoCoordinates",
    latitude: 33.41047791700064,
    longitude: -105.6845322600749
  },
  url: "https://casapatronalto.com/",
  sameAs: ["http://www.instagram.com/casapatronalto"],
  amenityFeature: [
    "Free parking",
    "Free WiFi",
    "Great room",
    "Ski closet",
    "Air conditioning",
    "Hot tub",
    "Cable TV",
    "Kitchen",
    "Summer games",
    "Patio"
  ],
  ...data
})

export const articleSchema = (post) => ({
  "@context": "https://schema.org",
  "@type": "Article",
  headline: post.data.title,
  description: post.data.description,
  author: {
    "@type": "Person",
    name: post.data.author
  },
  datePublished: post.data.date.toISOString(),
  dateModified: post.data.date.toISOString(),
  publisher: {
    "@type": "Organization",
    name: "Casa Patron",
    logo: {
      "@type": "ImageObject",
      url: "https://casapatronalto.com/cp-logo-white.png"
    }
  },
  mainEntityOfPage: {
    "@type": "WebPage",
    "@id": `https://casapatronalto.com/posts/${post.slug}/`
  }
})
```

## ‚ö° Performance Configuration

### Astro Config Optimization
```js
// astro.config.mjs
import { defineConfig } from 'astro/config'
import react from '@astrojs/react'
import sitemap from '@astrojs/sitemap'
import partytown from '@astrojs/partytown'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  site: 'https://casapatronalto.com',
  output: 'static', // SSG for maximum performance
  
  // Performance optimizations
  compressHTML: true,
  build: {
    inlineStylesheets: 'auto',
    assets: '_assets'
  },
  
  // Image optimization
  image: {
    remotePatterns: [{ protocol: "https" }],
    service: {
      entrypoint: 'astro/assets/services/sharp'
    }
  },
  
  vite: {
    plugins: [tailwindcss()],
    build: {
      cssCodeSplit: true,
      rollupOptions: {
        output: {
          manualChunks: {
            vendor: ['react', 'react-dom'],
            utils: ['clsx', 'tailwind-merge']
          }
        }
      }
    }
  },
  
  integrations: [
    react({
      include: ['**/react/**/*']
    }),
    sitemap({
      changefreq: 'weekly',
      priority: 0.7,
      lastmod: new Date(),
      filter: (page) => !page.includes('draft')
    }),
    partytown({
      config: {
        forward: ['dataLayer.push'],
        debug: false
      }
    })
  ]
})
```

### Image Optimization Strategy
```astro
---
// src/components/OptimizedImage.astro
import { Image } from 'astro:assets'

export interface Props {
  src: ImageMetadata | string
  alt: string
  width?: number
  height?: number
  quality?: number
  format?: 'webp' | 'avif' | 'jpeg' | 'png'
  loading?: 'eager' | 'lazy'
  class?: string
  sizes?: string
}

const {
  src,
  alt,
  width,
  height,
  quality = 80,
  format = 'webp',
  loading = 'lazy',
  class: className = '',
  sizes = '(min-width: 1024px) 1024px, 100vw'
} = Astro.props
---

<Image
  src={src}
  alt={alt}
  width={width}
  height={height}
  quality={quality}
  format={format}
  loading={loading}
  class={className}
  sizes={sizes}
/>
```

## üöÄ Core Web Vitals Optimization

### Loading Performance
```astro
---
// src/layouts/BaseLayout.astro - Performance optimizations
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Preload critical fonts -->
    <link rel="preload" href="/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin />
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://www.google-analytics.com" />
    
    <!-- Critical CSS inlined -->
    <style>
      /* Critical path CSS here */
      .loading { opacity: 0; }
      .loaded { opacity: 1; transition: opacity 0.3s; }
    </style>
    
    <slot name="head" />
  </head>
  <body>
    <slot />
    
    <!-- Non-critical scripts -->
    <script type="text/partytown">
      // Google Analytics in Partytown
      window.gtag = function() { dataLayer.push(arguments) }
    </script>
  </body>
</html>
```

### Lazy Loading Implementation
```astro
---
// src/components/LazySection.astro
export interface Props {
  threshold?: number
  rootMargin?: string
  class?: string
}

const { 
  threshold = 0.1, 
  rootMargin = '50px',
  class: className = ''
} = Astro.props
---

<section 
  class={`lazy-section loading ${className}`}
  data-threshold={threshold}
  data-root-margin={rootMargin}
>
  <slot />
</section>

<script>
  // Intersection Observer for lazy loading
  const observerOptions = {
    threshold: parseFloat(element.dataset.threshold || '0.1'),
    rootMargin: element.dataset.rootMargin || '50px'
  }
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('loaded')
        entry.target.classList.remove('loading')
        observer.unobserve(entry.target)
      }
    })
  }, observerOptions)
  
  document.querySelectorAll('.lazy-section').forEach(section => {
    observer.observe(section)
  })
</script>
```

## üìä Analytics & Tracking

### Privacy-Friendly Analytics
```astro
---
// src/components/Analytics.astro
const { analyticsId } = Astro.props
---

{analyticsId && (
  <script type="text/partytown" define:vars={{ analyticsId }}>
    // Google Analytics 4 in Partytown
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', analyticsId, {
      page_title: document.title,
      page_location: window.location.href,
      anonymize_ip: true,
      cookie_flags: 'max-age=7200;secure;samesite=none'
    });
  </script>
  
  <script type="text/partytown" src={`https://www.googletagmanager.com/gtag/js?id=${analyticsId}`}></script>
)}
```

## üîç Local SEO Optimization

### Local Business Structure
```astro
---
// src/pages/index.astro - Homepage with local SEO
import SEO from '../components/SEO.astro'
import { lodgingBusinessSchema } from '../utils/schema.js'

const schemaMarkup = lodgingBusinessSchema({
  offers: {
    "@type": "Offer",
    availability: "InStock",
    priceRange: "$240-$900",
    priceCurrency: "USD"
  }
})
---

<SEO
  title="Casa Patron: Short Term Vacation Rental Home in Alto, NM Near Ruidoso & Ski Apache"
  description="Escape to the stunning mountains of Alto, NM and stay at Casa Patron, a beautiful short term vacation rental home located near Ruidoso. Perfect for large parties near Ski Apache."
  keywords={[
    'vacation rental',
    'new mexico',
    'alto',
    'ski apache',
    'ruidoso',
    'retreat',
    'casa patron',
    'mountain cabin',
    'family friendly'
  ]}
  schemaMarkup={schemaMarkup}
  type="website"
/>
```

## üì± Mobile Optimization

### Responsive Images
```astro
---
import { Image } from 'astro:assets'
import heroDesktop from '../assets/hero-desktop.jpg'
import heroMobile from '../assets/hero-mobile.jpg'
---

<picture>
  <source 
    media="(min-width: 768px)"
    srcset={heroDesktop.src}
    width={heroDesktop.width}
    height={heroDesktop.height}
  />
  <Image
    src={heroMobile}
    alt="Casa Patron mountain view"
    width={heroMobile.width}
    height={heroMobile.height}
    loading="eager"
    format="webp"
    quality={85}
  />
</picture>
```

## ‚úÖ Performance Checklist

### Core Web Vitals
- [ ] Largest Contentful Paint (LCP) < 2.5s
- [ ] First Input Delay (FID) < 100ms
- [ ] Cumulative Layout Shift (CLS) < 0.1
- [ ] First Contentful Paint (FCP) < 1.8s

### SEO Checklist
- [ ] All pages have unique, descriptive titles
- [ ] Meta descriptions under 160 characters
- [ ] H1-H6 heading hierarchy is logical
- [ ] All images have alt text
- [ ] Schema markup implemented
- [ ] Sitemap generated and submitted
- [ ] Local business information consistent
- [ ] Internal linking strategy implemented

### Technical Performance
- [ ] Images optimized and properly sized
- [ ] CSS/JS bundles minimized
- [ ] Critical resources preloaded
- [ ] Third-party scripts use Partytown
- [ ] Lazy loading implemented
- [ ] Cache headers configured
- [ ] GZIP/Brotli compression enabled