---
// Google Analytics component using Partytown for performance optimization
const analyticsId = import.meta.env.GOOGLE_ANALYTICS_ID;
const isProduction = import.meta.env.PROD;
---

{isProduction && analyticsId && (
  <>
    <!-- Google Analytics 4 with Partytown for performance -->
    <script type="text/partytown" define:vars={{ analyticsId }}>
      // Initialize dataLayer and gtag function
      window.dataLayer = window.dataLayer || [];
      function gtag(){window.dataLayer.push(arguments);}
      
      // Configure analytics
      gtag('js', new Date());
      gtag('config', analyticsId, {
        // Privacy-friendly settings
        anonymize_ip: true,
        send_page_view: true,
        cookie_flags: 'max-age=7200;secure;samesite=strict',
        // Performance optimizations
        transport_type: 'beacon',
        custom_map: {
          'dimension1': 'page_location'
        }
      });
      
      // Track page views
      gtag('event', 'page_view', {
        page_title: document.title,
        page_location: window.location.href,
        page_path: window.location.pathname
      });
    </script>
    
    <!-- Load Google Analytics script via Partytown -->
    <script 
      type="text/partytown" 
      src={`https://www.googletagmanager.com/gtag/js?id=${analyticsId}`}
      async
    ></script>
  </>
)}

<!-- Development mode notification -->
{!isProduction && (
  <script>
    console.log('üîç Analytics disabled in development mode');
  </script>
)}